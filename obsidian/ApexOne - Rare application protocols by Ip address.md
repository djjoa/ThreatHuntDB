---
id: be89944e-4e75-4d0a-b2d6-ae757d22ed43
name: ApexOne - Rare application protocols by Ip address
description: |
  'Query searches rare application protocols by Ip address.'
severity: Medium
requiredDataConnectors:
  - connectorId: TrendMicroApexOne
    dataTypes:
      - TMApexOneEvent
  - connectorId: TrendMicroApexOneAma
    dataTypes:
      - TMApexOneEvent
tactics:
  - InitialAccess
relevantTechniques:
  - T1190
  - T1133
query: "```kusto\nTMApexOneEvent\n| where TimeGenerated > ago(24h)\n| where isnotempty(ApplicationProtocol)\n| extend AppProtocol = case(\nApplicationProtocol == \"0\", \"Unknown\", \nApplicationProtocol == \"1\", \"SMTP\",\nApplicationProtocol == \"2\", \"POP3\",\nApplicationProtocol == \"3\", \"IRC\", \nApplicationProtocol == \"4\", \"DNS Response\",\nApplicationProtocol == \"5\", \"HTTP\",\nApplicationProtocol == \"6\", \"FTP\", \nApplicationProtocol == \"7\", \"TFTP\",\nApplicationProtocol == \"8\", \"SMB\",\nApplicationProtocol == \"9\", \"Windows Live Messenger (MSN)\", \nApplicationProtocol == \"10\", \"AIM\",\nApplicationProtocol == \"11\", \"Yahoo! Messenger\",\nApplicationProtocol == \"12\", \"Gmail\",\nApplicationProtocol == \"13\", \"Yahoo! Mail\", \nApplicationProtocol == \"14\", \"Windows Live Hotmail\",\nApplicationProtocol == \"15\", \"RDP\",\nApplicationProtocol == \"16\", \"DHCP\",\nApplicationProtocol == \"17\", \"Telnet\", \nApplicationProtocol == \"18\", \"LDAP\",\nApplicationProtocol == \"19\", \"File transfer\",\nApplicationProtocol == \"20\", \"SSH\",\nApplicationProtocol == \"21\", \"Dameware\", \nApplicationProtocol == \"22\", \"VNC\",\nApplicationProtocol == \"23\", \"Cisco Telnet\",\nApplicationProtocol == \"24\", \"Kerberos\", \nApplicationProtocol == \"25\", \"DCE RPC\",\nApplicationProtocol == \"26\", \"SQL\",\nApplicationProtocol == \"27\", \"pcAnywhere\", \nApplicationProtocol == \"28\", \"ICMP\",\nApplicationProtocol == \"29\", \"SNMP\",\nApplicationProtocol == \"30\", \"Virus pattern TCP\", \nApplicationProtocol == \"31\", \"Virus pattern UDP\",\nApplicationProtocol == \"32\", \"HTTPS\",\nApplicationProtocol == \"33\", \"SMB2\",\nApplicationProtocol == \"34\", \"MMS\", \nApplicationProtocol == \"35\", \"IMAP4\",\nApplicationProtocol == \"36\", \"RADIUS\",\nApplicationProtocol == \"37\", \"Radmin\",\nApplicationProtocol == \"38\", \"FTP_Response\", \nApplicationProtocol == \"48\", \"RTSP/RTP-UDP\",\nApplicationProtocol == \"49\", \"RTSP/RTP-TCP\",\nApplicationProtocol == \"50\", \"RTSP/RDT-UDP\",\nApplicationProtocol == \"51\", \"RTSP/RDT-TCP\",\nApplicationProtocol == \"52\", \"WMSP\",\nApplicationProtocol == \"53\", \"SHOUTCast\", \nApplicationProtocol == \"54\", \"RTMP\",\nApplicationProtocol == \"68\", \"DNS Request\",\nApplicationProtocol == \"256\", \"BitTorrent\", \nApplicationProtocol == \"257\", \"Kazaa\",\nApplicationProtocol == \"258\", \"Limewire\",\nApplicationProtocol == \"259\", \"Bearshare\", \nApplicationProtocol == \"260\", \"Bluester\",\nApplicationProtocol == \"261\", \"Edonkey emule\",\nApplicationProtocol == \"262\", \"Edonkey2000\",\nApplicationProtocol == \"263\", \"Filezilla\", \nApplicationProtocol == \"264\", \"Guncleus\",\nApplicationProtocol == \"265\", \"Gnutella\",\nApplicationProtocol == \"266\", \"Winny\",\nApplicationProtocol == \"267\", \"Napster\", \nApplicationProtocol == \"268\", \"Morpheus\",\nApplicationProtocol == \"269\", \"Napster\",\nApplicationProtocol == \"270\", \"Shareaza\",\nApplicationProtocol == \"271\", \"WinMX\", \nApplicationProtocol == \"272\", \"Mldonkey\",\nApplicationProtocol == \"273\", \"Direct Connect\",\nApplicationProtocol == \"274\", \"Soulseek\", \nApplicationProtocol == \"275\", \"OpenAP\",\nApplicationProtocol == \"276\", \"Kuro\",\nApplicationProtocol == \"277\", \"Imesh\", \nApplicationProtocol == \"278\", \"Skype\",\nApplicationProtocol == \"279\", \"Google Talk\",\nApplicationProtocol == \"317\", \"Cabos\", \nApplicationProtocol == \"318\", \"Zultrax\",\nApplicationProtocol == \"319\", \"Foxy\",\nApplicationProtocol == \"320\", \"eDonkey\",\nApplicationProtocol == \"321\", \"Ares\", \nApplicationProtocol == \"322\", \"Miranda\",\nApplicationProtocol == \"323\", \"Kceasy\",\nApplicationProtocol == \"324\", \"MoodAmp\",\nApplicationProtocol == \"325\", \"Deepnet Explorer\", \nApplicationProtocol == \"326\", \"FreeWire\",\nApplicationProtocol == \"327\", \"Gimme\",\nApplicationProtocol == \"328\", \"GnucDNA GWebCache\",\nApplicationProtocol == \"329\", \"Jubster\",\nApplicationProtocol == \"330\", \"MyNapster\", \nApplicationProtocol == \"331\", \"Nova GWebCache\",\nApplicationProtocol == \"332\", \"Swapper GWebCache\",\nApplicationProtocol == \"333\", \"Xnap\",\nApplicationProtocol == \"334\", \"Xolox\", \nApplicationProtocol == \"335\", \"Ppstream\",\nApplicationProtocol == \"640\", \"AIM Express\",\nApplicationProtocol == \"641\", \"Chikka SMS Messenger\",\nApplicationProtocol == \"642\", \"eBuddy\", \nApplicationProtocol == \"643\", \"ICQ2Go\",\nApplicationProtocol == \"644\", \"ILoveIM Web Messenger\",\nApplicationProtocol == \"645\", \"IMUnitive\",\nApplicationProtocol == \"646\", \"Mabber\",\nApplicationProtocol == \"647\", \"Meebo\",\nApplicationProtocol == \"648\", \"Yahoo! Web Messenger\", \nApplicationProtocol == \"848\", \"SIP2\",\nApplicationProtocol == \"1024\", \"GPass\",\nApplicationProtocol == \"10001\", \"IP\",\nApplicationProtocol == \"10002\", \"ARP\",\nApplicationProtocol == \"10003\", \"TCP\", \nApplicationProtocol == \"10004\", \"UDP\",\nApplicationProtocol == \"10005\", \"IGMP\",\nApplicationProtocol == \"60\", \"ORACLE\", \nApplicationProtocol == \"44\", \"MySQL\",\nApplicationProtocol == \"520\", \"MSSQL\",\nApplicationProtocol == \"337\", \"Postgres\", \nApplicationProtocol == \"41\", \"ICMPv6\",\nApplicationProtocol == \"10006\", \"GGP\",\nApplicationProtocol == \"10007\", \"PUP\",\nApplicationProtocol == \"10008\", \"IDP\", \nApplicationProtocol == \"10009\", \"ND\",\nApplicationProtocol == \"10010\", \"RAW\",\n\"unknown\")\n| summarize ProtocolCount = count() by AppProtocol, SrcIpAddr, DstUserName\n| top 20 by ProtocolCount asc \n| extend IPCustomEntity = SrcIpAddr, AccountCustomEntity = DstUserName\n```"
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: IPCustomEntity
  - entityType: Account
    fieldMappings:
      - identifier: Name
        columnName: AccountCustomEntity
---

