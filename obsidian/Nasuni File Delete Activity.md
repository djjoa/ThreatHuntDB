---
id: 64a3477e-d06f-4491-86a5-6f99702e267f
name: Nasuni File Delete Activity
description: |
  'This query looks for file delete audit events generated by a Nasuni Edge Appliance.'
requiredDataConnectors:
  - connectorId: NasuniEdgeAppliance
    dataTypes:
      - Syslog
tactics:
  - Impact
relevantTechniques:
  - T1485
query: "```kusto\nSyslog \n| where SyslogMessage matches regex \"(nasuni.)([0-9A-Za-z]{8}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{4}-[0-9A-Za-z]{1})\"\n| extend SyslogMessageJson = extract('{(.*?)}', 0, SyslogMessage)\n| extend event_details = parse_json(SyslogMessageJson)\n| extend path_parts = parse_path(tostring(event_details.path))\n| extend SrcIpAdr = event_details.ipaddr\n| extend sAMAccountName = trim(@\"(?s)^.*\\\\\\s*\", tostring(event_details.username))\n| extend sid = event_details.sid\n| extend domainName = trim_end(@\"[\\\\]\\S*\", tostring(event_details.username))\n| extend HostName\n| extend filename = path_parts.Filename\n| extend directorypath = path_parts.DirectoryPath\n| where event_details.event_type == \"AUDIT_UNLINK\"\n| project\n    TimeGenerated,\n    HostName,\n    event_type = event_details.event_type,\n    sAMAccountName,\n    domainName,\n    filename,\n    directorypath,\n    SrcIpAdr,\n    sid,\n    volume_guid = event_details.volume,\n    access_point = event_details.resource,\n    primary_group_name = trim(@\"(?s)^.*\\\\\\s*\", tostring(event_details.groupname)),\n    new_path = event_details.newpath\n| extend Host_0_HostName = HostName\n| extend Account_0_Name = sAMAccountName\n| extend Account_0_NTDomain = domainName\n| extend Account_0_Sid = sid\n| extend File_0_Name = filename\n| extend File_0_Directory = directorypath\n| extend IP_0_Address = SrcIpAdr\n```"
entityMappings:
  - entityType: IP
    fieldMappings:
      - identifier: Address
        columnName: SrcIpAdr
  - entityType: Account
    fieldMappings:
      - identifier: Sid
        columnName: sid
      - identifier: Name
        columnName: sAMAccountName
      - identifier: NTDomain
        columnName: domainName
  - entityType: Host
    fieldMappings:
      - identifier: HostName
        columnName: HostName
  - entityType: File
    fieldMappings:
      - identifier: Name
        columnName: filename
      - identifier: Directory
        columnName: directorypath
version: 1.0.0
---

